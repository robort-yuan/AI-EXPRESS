

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Frequently asked questions &mdash; AI Express用户手册 2.7.0 文档</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> AI Express用户手册
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/overview.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/quick_start.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/xstream.html">XStream算法SDK编程框架开发指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/xproto.html">XProto原型应用开发框架开发指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/solution.html">场景参考解决方案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/tools.html">工具集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/version.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../BuildAll/doc/copyright.html">版权声明</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AI Express用户手册</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Frequently asked questions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/common/pybind11/docs/faq.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="frequently-asked-questions">
<h1>Frequently asked questions<a class="headerlink" href="#frequently-asked-questions" title="永久链接至标题">¶</a></h1>
<div class="section" id="importerror-dynamic-module-does-not-define-init-function">
<h2>“ImportError: dynamic module does not define init function”<a class="headerlink" href="#importerror-dynamic-module-does-not-define-init-function" title="永久链接至标题">¶</a></h2>
<p>1. Make sure that the name specified in PYBIND11_MODULE is identical to the
filename of the extension library (without prefixes such as .so)</p>
<p>2. If the above did not fix the issue, you are likely using an incompatible
version of Python (for instance, the extension library was compiled against
Python 2, while the interpreter is running on top of some version of Python
3, or vice versa).</p>
</div>
<div class="section" id="symbol-not-found-py-zerostruct-pyinstancemethod-type">
<h2>“Symbol not found: <code class="docutils literal notranslate"><span class="pre">__Py_ZeroStruct</span></code> / <code class="docutils literal notranslate"><span class="pre">_PyInstanceMethod_Type</span></code>”<a class="headerlink" href="#symbol-not-found-py-zerostruct-pyinstancemethod-type" title="永久链接至标题">¶</a></h2>
<p>See the first answer.</p>
</div>
<div class="section" id="systemerror-dynamic-module-not-initialized-properly">
<h2>“SystemError: dynamic module not initialized properly”<a class="headerlink" href="#systemerror-dynamic-module-not-initialized-properly" title="永久链接至标题">¶</a></h2>
<p>See the first answer.</p>
</div>
<div class="section" id="the-python-interpreter-immediately-crashes-when-importing-my-module">
<h2>The Python interpreter immediately crashes when importing my module<a class="headerlink" href="#the-python-interpreter-immediately-crashes-when-importing-my-module" title="永久链接至标题">¶</a></h2>
<p>See the first answer.</p>
</div>
<div class="section" id="cmake-doesn-t-detect-the-right-python-version">
<h2>CMake doesn’t detect the right Python version<a class="headerlink" href="#cmake-doesn-t-detect-the-right-python-version" title="永久链接至标题">¶</a></h2>
<p>The CMake-based build system will try to automatically detect the installed
version of Python and link against that. When this fails, or when there are
multiple versions of Python and it finds the wrong one, delete
<code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> and then invoke CMake as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DPYTHON_EXECUTABLE:FILEPATH<span class="o">=</span>&lt;path-to-python-executable&gt; .
</pre></div>
</div>
</div>
<div class="section" id="limitations-involving-reference-arguments">
<span id="faq-reference-arguments"></span><h2>Limitations involving reference arguments<a class="headerlink" href="#limitations-involving-reference-arguments" title="永久链接至标题">¶</a></h2>
<p>In C++, it’s fairly common to pass arguments using mutable references or
mutable pointers, which allows both read and write access to the value
supplied by the caller. This is sometimes done for efficiency reasons, or to
realize functions that have multiple return values. Here are two very basic
examples:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">increment</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">increment_ptr</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>In Python, all arguments are passed by reference, so there is no general
issue in binding such code from Python.</p>
<p>However, certain basic Python types (like <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>,
<code class="docutils literal notranslate"><span class="pre">float</span></code>, etc.) are <strong>immutable</strong>. This means that the following attempt
to port the function to Python doesn’t have the same effect on the value
provided by the caller – in fact, it does nothing at all.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># nope..</span>
</pre></div>
</div>
<p>pybind11 is also affected by such language-level conventions, which means that
binding <code class="docutils literal notranslate"><span class="pre">increment</span></code> or <code class="docutils literal notranslate"><span class="pre">increment_ptr</span></code> will also create Python functions
that don’t modify their arguments.</p>
<p>Although inconvenient, one workaround is to encapsulate the immutable types in
a custom type that does allow modifications.</p>
<p>An other alternative involves binding a small wrapper lambda function that
returns a tuple with all output arguments (see the remainder of the
documentation for examples on binding lambda functions). An example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span> <span class="k">return</span> <span class="mi">123</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>and the binding code</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="kt">int</span> <span class="n">rv</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="how-can-i-reduce-the-build-time">
<h2>How can I reduce the build time?<a class="headerlink" href="#how-can-i-reduce-the-build-time" title="永久链接至标题">¶</a></h2>
<p>It’s good practice to split binding code over multiple files, as in the
following example:</p>
<p><code class="file docutils literal notranslate"><span class="pre">example.cpp</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">init_ex1</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="k">module</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">init_ex2</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="k">module</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="cm">/* ... */</span>

<span class="n">PYBIND11_MODULE</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">init_ex1</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="n">init_ex2</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="cm">/* ... */</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="file docutils literal notranslate"><span class="pre">ex1.cpp</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">init_ex1</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="k">module</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">&quot;add&quot;</span><span class="p">,</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span> <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="file docutils literal notranslate"><span class="pre">ex2.cpp</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">init_ex2</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="k">module</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">&quot;sub&quot;</span><span class="p">,</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span> <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong class="command">python</strong>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">example</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>As shown above, the various <code class="docutils literal notranslate"><span class="pre">init_ex</span></code> functions should be contained in
separate files that can be compiled independently from one another, and then
linked together into the same final shared object.  Following this approach
will:</p>
<ol class="arabic simple">
<li><p>reduce memory requirements per compilation unit.</p></li>
<li><p>enable parallel builds (if desired).</p></li>
<li><p>allow for faster incremental builds. For instance, when a single class
definition is changed, only a subset of the binding code will generally need
to be recompiled.</p></li>
</ol>
</div>
<div class="section" id="recursive-template-instantiation-exceeded-maximum-depth-of-256">
<h2>“recursive template instantiation exceeded maximum depth of 256”<a class="headerlink" href="#recursive-template-instantiation-exceeded-maximum-depth-of-256" title="永久链接至标题">¶</a></h2>
<p>If you receive an error about excessive recursive template evaluation, try
specifying a larger value, e.g. <code class="docutils literal notranslate"><span class="pre">-ftemplate-depth=1024</span></code> on GCC/Clang. The
culprit is generally the generation of function signatures at compile time
using C++14 template metaprogramming.</p>
</div>
<div class="section" id="someclass-declared-with-greater-visibility-than-the-type-of-its-field-someclass-member-wattributes">
<span id="faq-hidden-visibility"></span><h2>“‘SomeClass’ declared with greater visibility than the type of its field ‘SomeClass::member’ [-Wattributes]”<a class="headerlink" href="#someclass-declared-with-greater-visibility-than-the-type-of-its-field-someclass-member-wattributes" title="永久链接至标题">¶</a></h2>
<p>This error typically indicates that you are compiling without the required
<code class="docutils literal notranslate"><span class="pre">-fvisibility</span></code> flag.  pybind11 code internally forces hidden visibility on
all internal code, but if non-hidden (and thus <em>exported</em>) code attempts to
include a pybind type (for example, <code class="docutils literal notranslate"><span class="pre">py::object</span></code> or <code class="docutils literal notranslate"><span class="pre">py::list</span></code>) you can run
into this warning.</p>
<p>To avoid it, make sure you are specifying <code class="docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code> when
compiling pybind code.</p>
<p>As to why <code class="docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code> is necessary, because pybind modules could
have been compiled under different versions of pybind itself, it is also
important that the symbols defined in one module do not clash with the
potentially-incompatible symbols defined in another.  While Python extension
modules are usually loaded with localized symbols (under POSIX systems
typically using <code class="docutils literal notranslate"><span class="pre">dlopen</span></code> with the <code class="docutils literal notranslate"><span class="pre">RTLD_LOCAL</span></code> flag), this Python default
can be changed, but even if it isn’t it is not always enough to guarantee
complete independence of the symbols involved when not using
<code class="docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code>.</p>
<p>Additionally, <code class="docutils literal notranslate"><span class="pre">-fvisiblity=hidden</span></code> can deliver considerably binary size
savings.  (See the following section for more details).</p>
</div>
<div class="section" id="how-can-i-create-smaller-binaries">
<span id="faq-symhidden"></span><h2>How can I create smaller binaries?<a class="headerlink" href="#how-can-i-create-smaller-binaries" title="永久链接至标题">¶</a></h2>
<p>To do its job, pybind11 extensively relies on a programming technique known as
<em>template metaprogramming</em>, which is a way of performing computation at compile
time using type information. Template metaprogamming usually instantiates code
involving significant numbers of deeply nested types that are either completely
removed or reduced to just a few instructions during the compiler’s optimization
phase. However, due to the nested nature of these types, the resulting symbol
names in the compiled extension library can be extremely long. For instance,
the included test suite contains the following symbol:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>_​_​Z​N​8​p​y​b​i​n​d​1​1​1​2​c​p​p​_​f​u​n​c​t​i​o​n​C​1​I​v​8​E​x​a​m​p​l​e​2​J​R​N​S​t​3​_​_​1​6​v​e​c​t​o​r​I​N​S​3​_​1​2​b​a​s​i​c​_​s​t​r​i​n​g​I​w​N​S​3​_​1​1​c​h​a​r​_​t​r​a​i​t​s​I​w​E​E​N​S​3​_​9​a​l​l​o​c​a​t​o​r​I​w​E​E​E​E​N​S​8​_​I​S​A​_​E​E​E​E​E​J​N​S​_​4​n​a​m​e​E​N​S​_​7​s​i​b​l​i​n​g​E​N​S​_​9​i​s​_​m​e​t​h​o​d​E​A​2​8​_​c​E​E​E​M​T​0​_​F​T​_​D​p​T​1​_​E​D​p​R​K​T​2​_
</pre></div>
</div>
<p>which is the mangled form of the following function type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pybind11</span><span class="o">::</span><span class="n">cpp_function</span><span class="o">::</span><span class="n">cpp_function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">,</span> <span class="n">Example2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;&amp;</span><span class="p">,</span> <span class="n">pybind11</span><span class="o">::</span><span class="n">name</span><span class="p">,</span> <span class="n">pybind11</span><span class="o">::</span><span class="n">sibling</span><span class="p">,</span> <span class="n">pybind11</span><span class="o">::</span><span class="n">is_method</span><span class="p">,</span> <span class="kt">char</span> <span class="p">[</span><span class="mi">28</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="n">Example2</span><span class="o">::*</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;&amp;</span><span class="p">),</span> <span class="n">pybind11</span><span class="o">::</span><span class="n">name</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">pybind11</span><span class="o">::</span><span class="n">sibling</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">pybind11</span><span class="o">::</span><span class="n">is_method</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="p">(</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">[</span><span class="mi">28</span><span class="p">])</span>
</pre></div>
</div>
<p>The memory needed to store just the mangled name of this function (196 bytes)
is larger than the actual piece of code (111 bytes) it represents! On the other
hand, it’s silly to even give this function a name – after all, it’s just a
tiny cog in a bigger piece of machinery that is not exposed to the outside
world. So we’ll generally only want to export symbols for those functions which
are actually called from the outside.</p>
<p>This can be achieved by specifying the parameter <code class="docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code> to GCC
and Clang, which sets the default symbol visibility to <em>hidden</em>, which has a
tremendous impact on the final binary size of the resulting extension library.
(On Visual Studio, symbols are already hidden by default, so nothing needs to
be done there.)</p>
<p>In addition to decreasing binary size, <code class="docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code> also avoids
potential serious issues when loading multiple modules and is required for
proper pybind operation.  See the previous FAQ entry for more details.</p>
</div>
<div class="section" id="working-with-ancient-visual-studio-2008-builds-on-windows">
<h2>Working with ancient Visual Studio 2008 builds on Windows<a class="headerlink" href="#working-with-ancient-visual-studio-2008-builds-on-windows" title="永久链接至标题">¶</a></h2>
<p>The official Windows distributions of Python are compiled using truly
ancient versions of Visual Studio that lack good C++11 support. Some users
implicitly assume that it would be impossible to load a plugin built with
Visual Studio 2015 into a Python distribution that was compiled using Visual
Studio 2008. However, no such issue exists: it’s perfectly legitimate to
interface DLLs that are built with different compilers and/or C libraries.
Common gotchas to watch out for involve not <code class="docutils literal notranslate"><span class="pre">free()</span></code>-ing memory region
that that were <code class="docutils literal notranslate"><span class="pre">malloc()</span></code>-ed in another shared library, using data
structures with incompatible ABIs, and so on. pybind11 is very careful not
to make these types of mistakes.</p>
</div>
<div class="section" id="how-can-i-properly-handle-ctrl-c-in-long-running-functions">
<h2>How can I properly handle Ctrl-C in long-running functions?<a class="headerlink" href="#how-can-i-properly-handle-ctrl-c-in-long-running-functions" title="永久链接至标题">¶</a></h2>
<p>Ctrl-C is received by the Python interpreter, and holds it until the GIL
is released, so a long-running function won’t be interrupted.</p>
<p>To interrupt from inside your function, you can use the <code class="docutils literal notranslate"><span class="pre">PyErr_CheckSignals()</span></code>
function, that will tell if a signal has been raised on the Python side.  This
function merely checks a flag, so its impact is negligible. When a signal has
been received, you must either explicitly interrupt execution by throwing
<code class="docutils literal notranslate"><span class="pre">py::error_already_set</span></code> (which will propagate the existing
<code class="docutils literal notranslate"><span class="pre">KeyboardInterrupt</span></code>), or clear the error (which you usually will not want):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">PYBIND11_MODULE</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">&quot;long running_func&quot;</span><span class="p">,</span> <span class="p">[]()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">PyErr_CheckSignals</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">py</span><span class="o">::</span><span class="n">error_already_set</span><span class="p">();</span>
            <span class="c1">// Long running iteration</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="inconsistent-detection-of-python-version-in-cmake-and-pybind11">
<h2>Inconsistent detection of Python version in CMake and pybind11<a class="headerlink" href="#inconsistent-detection-of-python-version-in-cmake-and-pybind11" title="永久链接至标题">¶</a></h2>
<p>The functions <code class="docutils literal notranslate"><span class="pre">find_package(PythonInterp)</span></code> and <code class="docutils literal notranslate"><span class="pre">find_package(PythonLibs)</span></code> provided by CMake
for Python version detection are not used by pybind11 due to unreliability and limitations that make
them unsuitable for pybind11’s needs. Instead pybind provides its own, more reliable Python detection
CMake code. Conflicts can arise, however, when using pybind11 in a project that <em>also</em> uses the CMake
Python detection in a system with several Python versions installed.</p>
<p>This difference may cause inconsistencies and errors if <em>both</em> mechanisms are used in the same project. Consider the following
Cmake code executed in a system with Python 2.7 and 3.x installed:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">PythonInterp</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">PythonLibs</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">pybind11</span><span class="p">)</span>
</pre></div>
</div>
<p>It will detect Python 2.7 and pybind11 will pick it as well.</p>
<p>In contrast this code:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">pybind11</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">PythonInterp</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">PythonLibs</span><span class="p">)</span>
</pre></div>
</div>
<p>will detect Python 3.x for pybind11 and may crash on <code class="docutils literal notranslate"><span class="pre">find_package(PythonLibs)</span></code> afterwards.</p>
<p>It is advised to avoid using <code class="docutils literal notranslate"><span class="pre">find_package(PythonInterp)</span></code> and <code class="docutils literal notranslate"><span class="pre">find_package(PythonLibs)</span></code> from CMake and rely
on pybind11 in detecting Python version. If this is not possible CMake machinery should be called <em>before</em> including pybind11.</p>
</div>
<div class="section" id="how-to-cite-this-project">
<h2>How to cite this project?<a class="headerlink" href="#how-to-cite-this-project" title="永久链接至标题">¶</a></h2>
<p>We suggest the following BibTeX template to cite pybind11 in scientific
discourse:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>@misc<span class="o">{</span>pybind11,
   <span class="nv">author</span> <span class="o">=</span> <span class="o">{</span>Wenzel Jakob and Jason Rhinelander and Dean Moldovan<span class="o">}</span>,
   <span class="nv">year</span> <span class="o">=</span> <span class="o">{</span><span class="m">2017</span><span class="o">}</span>,
   <span class="nv">note</span> <span class="o">=</span> <span class="o">{</span>https://github.com/pybind/pybind11<span class="o">}</span>,
   <span class="nv">title</span> <span class="o">=</span> <span class="o">{</span>pybind11 -- Seamless operability between C++11 and Python<span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2020, Horizon Robotics

    </p>
  </div>
    
    
    
    利用 <a href="http://sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>