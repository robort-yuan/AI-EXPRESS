

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>智能计算盒参考方案 &mdash; AI Express用户手册 2.7.0 文档</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> AI Express用户手册
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/overview.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/quick_start.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/xstream.html">XStream算法SDK编程框架开发指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/xproto.html">XProto原型应用开发框架开发指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/solution.html">场景参考解决方案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/tools.html">工具集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/version.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BuildAll/doc/copyright.html">版权声明</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AI Express用户手册</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>智能计算盒参考方案</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/ai_express_release/source/solution_zoo/video_box/README.md.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>智能计算盒参考方案<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="id2">
<h2>介绍<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>智能计算盒参考方案，主要功能是接收多路IPC的RTSP码流，解码后进行智能分析，并将分析结果渲染VO输出，或者再通过RTSP推流发送出去。</p>
</div>
<div class="section" id="id3">
<h2>能力<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>当前DEMO智能分析使用的模型是Body Solution模型，检测结果有人脸框，人脸关键点，人体框，人体关键点等信息。最大支持接收8路RTSP码流，以及2路（1080P，720P）RTSP推流。</p>
</div>
<div class="section" id="id4">
<h2>编译<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">build</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>打包部署包<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">deploy</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>该脚本会在当前目录下创建deploy文件夹，里面包含通用库、VIO配置文件、模型及body_solution目录</p>
</div>
<div class="section" id="id6">
<h2>运行<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>将部署包拷贝到板子上，即可运行。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>运行run.sh，选择video_box选项即可。
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2>配置文件说明<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>1.video_box_config.json</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;xstream_workflow_file&quot;: &quot;./video_box/configs/body_detection.json&quot;,	// xstream配置文件 
  &quot;enable_profile&quot;: 0,
  &quot;profile_log_path&quot;: &quot;&quot;,
  &quot;enable_result_to_json&quot;: false,
  &quot;box_face_thr&quot;: 0.95,													// 人脸框阈值
  &quot;box_head_thr&quot;: 0.95,													// 人头框阈值
  &quot;box_body_thr&quot;: 0.95,													// 人体框阈值
  &quot;lmk_thr&quot;: 0.0,
  &quot;kps_thr&quot;: 0.50,
  &quot;box_veh_thr&quot;: 0.995,
  &quot;plot_fps&quot;: false,
  &quot;rtsp_config_file&quot;: &quot;./video_box/configs/rtsp.json&quot;,					// rtsp配置文件
  &quot;display_config_file&quot;: &quot;./video_box/configs/display.json&quot;,				// 显示配置文件
  &quot;drop_frame_config_file&quot;: &quot;./video_box/configs/drop_frames.json&quot;  // 配置是否丢帧以及丢帧策略
}
</pre></div>
</div>
<p>2.rtsp.json</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;channel_num&quot;: 4,                            					// 连接路数
  &quot;channel0&quot;: {
    &quot;rtsp_link&quot;: &quot;rtsp://admin:admin123@10.96.35.66:554/0&quot;,   	// rtsp URL地址
    &quot;tcp&quot;: 1,													// 是否使用TCP连接
    &quot;frame_max_size&quot;: 200, 										// 码流最大包大小，单位为KB
    &quot;save_stream&quot;: 0											// 是否保存当前码流到本地
  },
  &quot;channel1&quot;: {
    &quot;rtsp_link&quot;: &quot;rtsp://admin:admin123@10.96.35.199:554/0&quot;,
    &quot;tcp&quot;: 0,
    &quot;frame_max_size&quot;: 200,
    &quot;save_stream&quot;: 0
  },
  &quot;channel2&quot;: {
    &quot;rtsp_link&quot;: &quot;rtsp://admin:admin123@10.96.35.66:554/0&quot;,
    &quot;tcp&quot;: 1,
    &quot;frame_max_size&quot;: 200,
    &quot;save_stream&quot;: 0
  },
  &quot;channel3&quot;: {
    &quot;rtsp_link&quot;: &quot;rtsp://admin:admin123@10.96.35.66:554/0&quot;,
    &quot;tcp&quot;: 0,
    &quot;frame_max_size&quot;: 200,
    &quot;save_stream&quot;: 0
  }
}
</pre></div>
</div>
<p>3.display.json</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;vo&quot;: {
    &quot;enable&quot;: true,											// 是否开启VO输出
    &quot;display_mode&quot;: 0 									  	// 显示模式，0: auto, 1: 9 pictures
  },
  &quot;rtsp&quot;: {
    &quot;stream_1080p&quot;: false,									// 是否开启1080P RTSP码流推送
    &quot;stream_720p&quot;: false									// 是否开启720P RTSP码流推送
  }
}
</pre></div>
</div>
<p>4.visualplugin_video_box.json</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;auth_mode&quot;: 0,								// RTSP推流是否开启密码验证功能
  &quot;display_mode&quot;: 1,							// 设置为0开启本地转发或推流功能
  &quot;user&quot;: &quot;admin&quot;,								// RTSP推流用户名
  &quot;password&quot;: &quot;123456&quot;,							// RTSP推流密码
  &quot;data_buf_size&quot;: 3110400,						// live555缓存区大小
  &quot;packet_size&quot;: 102400,						// live555分包大小
  &quot;input_h264_filename&quot;: &quot;&quot;,					// 需要转发的码流文件名，不需要转发则置空
  &quot;local_forward&quot;: 1							// 必须设置为1
}
</pre></div>
</div>
<p>5.drop_frames.json</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
    &quot;frame_drop&quot;: {
        &quot;drop_frame&quot;: false,      // 是否丢帧
        &quot;interval_frames_num&quot;: 2  // 间隔多少帧丢弃一帧
    }
}
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h2>常见问题<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>1.拉取码流出错</p>
<ol class="simple">
<li><p>rtsp.json文件里面的url地址问题，注意检查url的用户名密码以及ip。</p></li>
<li><p>设备支持的连接数目达到最大限制，不再支持继续接入。
比如，某些设备rtsp的tcp方式最大支持一路，当前已使用tcp接入了一路，此时可修改rtsp.json对应通道的连接方式。</p></li>
</ol>
<p>2.解码出错</p>
<p>1）目前接收码流buffer默认为200KB，如果码流帧大小超过200KB，会导致接收到的帧不完整，送给解码器后解码失败。
码流帧大小的限制可以在rtsp.json文件里面修改。</p>
<p>2）送给解码器要是一帧完整的帧，包含start code（0x00 0x00 0x00 0x01）、SPS、PPS数据头。</p>
<p>3.程序启动失败</p>
<p>运行多路时，比如8路，程序启动失败，可能原因是默认ion Buffer设置太小，需要手动修改下，修改方法为 uboot 命令行下修改环境变量的，命令如下。</p>
<p>以配置 1GB ion 空间为例：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>setenv ion_size <span class="s1">&#39;1024&#39;</span> 
saveenv 
</pre></div>
</div>
<p>4.HDMI没有显示</p>
<p>开发板硬件上支持 HDMI 和 LCD 两种 display 方式，默认显示方式为LCD，若要HDMI显示需要手动在<code class="docutils literal notranslate"><span class="pre">uboot</span></code>下修改环境变量切换，切换命令如下。
HDMI 方式：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>setenv bootargs earlycon <span class="nv">console</span><span class="o">=</span>ttyS0,921600 clk_ignore_unused <span class="nv">video</span><span class="o">=</span>hobot:x3sdb-hdmi <span class="nv">kgdboc</span><span class="o">=</span>ttyS0 
saveenv 
</pre></div>
</div>
<p>LCD 方式：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>setenv bootargs earlycon <span class="nv">console</span><span class="o">=</span>ttyS0,921600 clk_ignore_unused <span class="nv">video</span><span class="o">=</span>hobot:x3sdb-mipi720p <span class="nv">kgdboc</span><span class="o">=</span>ttyS0 
saveenv 
</pre></div>
</div>
<p>5、显示模式
目前支持单画面，4画面，9画面显示的方式。默认是根据接入的路数动态切换显示画面的个数。若需要修改显示方式，可以在配置文件修改display_mode字段。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2020, Horizon Robotics

    </p>
  </div>
    
    
    
    利用 <a href="http://sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>